{% extends "layout.html" %}
{% load template_tags %}
{% block title %}
    Enumeration Area Lists
{% endblock %}

{% block content %}
    <br><a href="{% url 'new_enumeration_area_page' %}" class="btn btn_primary pull-right" id="add-module"><i class="icon-plus"></i> Add Enumeration Area</a>
    <br class="clear"/>
    <form action="" method="get">
    {% include "horizontal_naked_form.html" with a_form=locations_filter %}
    <button class="btn btn-primary" id="a-ea-list">Refresh List</button>
    </form>
    <br class="clear"/>
    {% include "search_form.html" %}
    <br/>
    <table class="table table-striped table-bordered table-hover">
        <thead>
          <tr>
            <th>
              Name
            </th>
            <th>
              Locations
            </th>
              <th>
              Total Households
            </th>
            <th>
            	Actions
            </th>
          </tr>
        </thead>
        <tbody>
        {% for ea in enumeration_areas %}
            <tr id="ea-{{ea.pk}}" class="eas">
                <td>{{ ea.name }}</td>
                <td>{% for location in ea.locations.all %} {{ location.name }}, {% endfor %}</td>
                <td> {{ ea.total_households }} </td>
                <td>
                <div class="btn-group">
                     <a class="btn btn-small" href="{% url 'edit_enumeration_area_page' ea.pk %}" id="edit_ea"><i
                             class="icon-pencil"></i> Edit</a>
                     <a class="btn btn-small" href="#delete_enumeration_area_{{ ea.pk }}" data-toggle="modal"
                        id="delete_question"><i class="icon-trash"></i> Delete</a>
                 
             </div>
                </td>
            </tr>
            {% include "base/delete_modal.html" with object_name=ea.name id=ea.id name="Enumeration Area" url=ea.id|get_url_with_ids:"delete_enumeration_area" %}
        {% endfor %}
        </tbody>
    </table>
{% endblock %}

{% block javascripts %}
    <script type="text/javascript" charset="utf-8">
	    $("#a-ea-list").hide();
	    
	    $('.location_filter').on('change', function () {
	    	{% for location_type in location_filter_types %}
	    	   var {{ location_type }}_selected = $('#id_{{ location_type }}').val();
	    	{% endfor %}
	    	url = "{% url 'enumeration_area_filter' %}";
	        params = { 
	        		{% for location_type in location_filter_types %}
	        			{{ location_type }} : {{ location_type }}_selected,
	 	    		{% endfor %}	
	        }
	        $.getJSON(url, params, function (data) {
	        	$('.eas').hide();
	            $.each(data, function () {
	            	$('#ea-'+this.id).show();
	            });
	        });
	    });
	    
	
	    
	    {% for location_type in location_filter_types %}
	    $('#id_{{ location_type }}').on('change', function () {
	    	params = { 'parent_loc' : $('#id_{{ location_type }}').val(), 'type' : '{{ location_type.pk }}'};
	    	url = "{% url 'location_sub_types' %}";
	        $.getJSON(url, params, function (data) {
	        	$('#id_' + data.sub_type +' option').hide();
	        	$('#id_' + data.sub_type +' option[value=""]').show();
        		$.each(data.locations, function () {
	                $('#id_' + data.sub_type +' option[value='+this.id+']').show();
	            });
        		$(' .chzn-select').trigger("liszt:updated");  
	        });
 	  		 
	    });
 		{% endfor %}
    </script>
{% endblock %}
